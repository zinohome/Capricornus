{"version":3,"sources":["components/date-picker/fix-events-plugin.ts"],"names":["on","config","fp","handleKeydown","event","inputFrom","inputTo","key","target","setDate","value","dateFormat","stopPropagation","release","_hBXCEDatePickerFixEventsPluginKeydownTo","_hBXCEDatePickerFixEventsPluginKeydownFrom","init","register","loadedPlugins","push","onReady","onDestroy"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA,OAAOA,EAAP,MAAe,yCAAf;;AAkCA;AACA;AACA;AACA;AACA,gBAAgBC,MAAD,IACZC,EAAD,IAAkD;AAChD;AACJ;AACA;AACI,QAAMC,aAAa,GAAIC,KAAD,IAA0B;AAC9C,UAAM;AAAEC,MAAAA,SAAF;AAAaC,MAAAA;AAAb,QAAyBL,MAA/B;AACA,UAAM;AAAEM,MAAAA,GAAF;AAAOC,MAAAA;AAAP,QAAkBJ,KAAxB;;AACA,QAAIC,SAAS,KAAKG,MAAd,IAAwBF,OAAO,KAAKE,MAAxC,EAAgD;AAC9C,cAAQD,GAAR;AACE,aAAK,OAAL;AACE;AACA;AACAL,UAAAA,EAAE,CAACO,OAAH,CAAW,CAACJ,SAAS,CAACK,KAAX,EAAoBJ,OAAO,IAAIA,OAAO,CAACI,KAAvC,CAAX,EAA4D,IAA5D,EAAkER,EAAE,CAACD,MAAH,CAAUU,UAA5E;AACAP,UAAAA,KAAK,CAACQ,eAAN;AACA;;AACF,aAAK,WAAL;AACA,aAAK,MAAL;AACA,aAAK,YAAL;AACA,aAAK,OAAL;AACE;AACA;AACA;AACAR,UAAAA,KAAK,CAACQ,eAAN;AACA;;AACF;AACE;AAjBJ;AAmBD;AACF,GAxBD;AA0BA;AACJ;AACA;;;AACI,QAAMC,OAAO,GAAG,MAAM;AACpB,QAAIX,EAAE,CAACY,wCAAP,EAAiD;AAC/CZ,MAAAA,EAAE,CAACY,wCAAH,GAA8CZ,EAAE,CAACY,wCAAH,CAA4CD,OAA5C,EAA9C;AACD;;AACD,QAAIX,EAAE,CAACa,0CAAP,EAAmD;AACjDb,MAAAA,EAAE,CAACa,0CAAH,GAAgDb,EAAE,CAACa,0CAAH,CAA8CF,OAA9C,EAAhD;AACD;AACF,GAPD;AASA;AACJ;AACA;;;AACI,QAAMG,IAAI,GAAG,MAAM;AACjBH,IAAAA,OAAO;AACP,UAAM;AAAER,MAAAA,SAAF;AAAaC,MAAAA;AAAb,QAAyBL,MAA/B;AACAC,IAAAA,EAAE,CAACa,0CAAH,GAAgDf,EAAE,CAACK,SAAD,EAAY,SAAZ,EAAuBF,aAAvB,EAAsC,IAAtC,CAAlD;;AACA,QAAIG,OAAJ,EAAa;AACXJ,MAAAA,EAAE,CAACY,wCAAH,GAA8Cd,EAAE,CAACM,OAAD,EAAU,SAAV,EAAqBH,aAArB,EAAoC,IAApC,CAAhD;AACD;AACF,GAPD;AASA;AACJ;AACA;;;AACI,QAAMc,QAAQ,GAAG,MAAM;AACrBf,IAAAA,EAAE,CAACgB,aAAH,CAAiBC,IAAjB,CAAsB,gCAAtB;AACD,GAFD;;AAIA,SAAO;AACLC,IAAAA,OAAO,EAAE,CAACH,QAAD,EAAWD,IAAX,CADJ;AAELK,IAAAA,SAAS,EAAE,CAACR,OAAD;AAFN,GAAP;AAID,CAlEH","sourcesContent":["/**\n * @license\n *\n * Copyright IBM Corp. 2019, 2021\n *\n * This source code is licensed under the Apache-2.0 license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nimport { Instance as FlatpickrInstance } from 'flatpickr/dist/types/instance';\nimport { Plugin } from 'flatpickr/dist/types/options';\nimport on from 'carbon-components/es/globals/js/misc/on';\nimport Handle from '../../globals/internal/handle';\nimport BXDatePickerInput from './date-picker-input';\n\n/**\n * The configuration for the Flatpickr plugin to fix Flatpickr's behavior of certain events.\n */\nexport interface DatePickerFixEventsPluginConfig {\n  /**\n   * The input box to enter starting date.\n   */\n  inputFrom: BXDatePickerInput;\n\n  /**\n   * The input box to enter end date.\n   */\n  inputTo?: BXDatePickerInput;\n}\n\n/**\n * `FlatpickrInstance` with additional properties used for `carbonFlatpickrFixEventsPlugin`.\n */\nexport interface ExtendedFlatpickrInstanceFixEventsPlugin extends FlatpickrInstance {\n  /**\n   * The handle for `keydown` event handler in the `<input>` for the starting date.\n   */\n  _hBXCEDatePickerFixEventsPluginKeydownFrom?: Handle | null;\n\n  /**\n   * The handle for `keydown` event handler in the `<input>` for the end date.\n   */\n  _hBXCEDatePickerFixEventsPluginKeydownTo?: Handle | null;\n}\n\n/**\n * @param config Plugin configuration.\n * @returns A Flatpickr plugin to fix Flatpickr's behavior of certain events.\n */\nexport default (config: DatePickerFixEventsPluginConfig): Plugin =>\n  (fp: ExtendedFlatpickrInstanceFixEventsPlugin) => {\n    /**\n     * Handles `keydown` event.\n     */\n    const handleKeydown = (event: KeyboardEvent) => {\n      const { inputFrom, inputTo } = config;\n      const { key, target } = event;\n      if (inputFrom === target || inputTo === target) {\n        switch (key) {\n          case 'Enter':\n            // Makes sure the hitting enter key picks up pending values of both `<input>`\n            // Workaround for: https://github.com/flatpickr/flatpickr/issues/1942\n            fp.setDate([inputFrom.value!, (inputTo && inputTo.value)!], true, fp.config.dateFormat);\n            event.stopPropagation();\n            break;\n          case 'ArrowLeft':\n          case 'Left':\n          case 'ArrowRight':\n          case 'Right':\n            // Prevents Flatpickr code from canceling the event if left/right arrow keys are hit on `<input>`,\n            // so user can move the keyboard cursor for editing dates\n            // Workaround for: https://github.com/flatpickr/flatpickr/issues/1943\n            event.stopPropagation();\n            break;\n          default:\n            break;\n        }\n      }\n    };\n\n    /**\n     * Releases event listeners used in this Flatpickr plugin.\n     */\n    const release = () => {\n      if (fp._hBXCEDatePickerFixEventsPluginKeydownTo) {\n        fp._hBXCEDatePickerFixEventsPluginKeydownTo = fp._hBXCEDatePickerFixEventsPluginKeydownTo.release();\n      }\n      if (fp._hBXCEDatePickerFixEventsPluginKeydownFrom) {\n        fp._hBXCEDatePickerFixEventsPluginKeydownFrom = fp._hBXCEDatePickerFixEventsPluginKeydownFrom.release();\n      }\n    };\n\n    /**\n     * Sets up event listeners used for this Flatpickr plugin.\n     */\n    const init = () => {\n      release();\n      const { inputFrom, inputTo } = config;\n      fp._hBXCEDatePickerFixEventsPluginKeydownFrom = on(inputFrom, 'keydown', handleKeydown, true);\n      if (inputTo) {\n        fp._hBXCEDatePickerFixEventsPluginKeydownTo = on(inputTo, 'keydown', handleKeydown, true);\n      }\n    };\n\n    /**\n     * Registers this Flatpickr plugin.\n     */\n    const register = () => {\n      fp.loadedPlugins.push('carbonFlatpickrFixEventsPlugin');\n    };\n\n    return {\n      onReady: [register, init],\n      onDestroy: [release],\n    };\n  };\n"],"file":"fix-events-plugin.js"}